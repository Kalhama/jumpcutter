<!DOCTYPE html>
<html lang='en'>
  <!-- https://www.creativebloq.com/html5/build-custom-html5-video-player-9134473 -->
  <!-- https://www.w3schools.com/tags/ref_av_dom.asp -->
   <head>
      <meta charset='utf-8' />
      <title>Sample HTML5 Media Player</title>
      <style>

      </style>
      <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
      <script type="text/javascript" src="silence.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", initialiseMediaPlayer, false);
        var mediaPlayer;
        function initialiseMediaPlayer() {
          mediaPlayer = document.getElementById('media-video');

          const isSilent = () => silence.find(obj => obj.start < mediaPlayer.currentTime && obj.end > mediaPlayer.currentTime + 0.1) ? true : false
          const nextVoice = () => silence.find(obj => obj.start <= mediaPlayer.currentTime && obj.end >= mediaPlayer.currentTime).end
          const seek = timestamp => mediaPlayer.currentTime = timestamp
          const skipQuiet = () => {
            const { currentTime, duration } = mediaPlayer

            if (isSilent()) {
              console.log(`seeking to ${nextVoice()} from ${mediaPlayer.currentTime}`)
              seek(nextVoice())
              console.log(`current timestamp ${mediaPlayer.currentTime}`)
            }
          }
          /*
          const renderProgressBar = () => {
            const arr = []
            const silentAreas = silence.map(obj => {
              return {
                start: start / mediaPlayer.duration,
                end: end / mediaPlayer.duration
              }
            })

            // render silent area blocks
            // TODO
          }
          */

          const updateProgressBar = () => {
            var percentage = mediaPlayer.currentTime / mediaPlayer.duration * 100
            console.log("prossat", percentage)
            $("#progress").width(percentage + '%')
          }

          mediaPlayer.addEventListener('timeupdate', skipQuiet, false);
          // mediaPlayer.addEventListener('timeupdate', updateProgressBar, false);

          console.log("silent: ", silence.map(obj => obj.duration).reduce((a, b) => a + b)/60, "min")
        }
      </script>
   </head>
   <body>
      <div id='media-player'>
         <video id='media-video' controls>
            <source src='video.mp4' type='video/mp4'>
         </video>
         <div id='media-controls'></div>
         <div id="progress_container" style="height: 10px">

          </div>
      </div>
   </body>
</html>